## 🎯 **最終目標**
高性能PC上で、**複数プロジェクターを用いたリアルタイム歪み補正・メディア表示システム**を実行。

---

## 🖥️ **ハードウェア構成**

* **PCスペック**：
  * CPU: Intel Core i9
  * GPU: GeForce RTX 4070 Ti SUPER
  * メモリ: DDR5 32GB
  * ストレージ: M.2 SSD 2TB

* **表示機器**：
  * プロジェクター：オプトマ GT1080 x 3台（表示用）
  * モニター：1台（編集用）

---

## 🛠️ **開発環境**
* エディタ：VS Code
* ターミナル：PowerShell（VS Code統合ターミナル）
* 出力形式：.exe形式のGUIアプリケーション（PyInstaller等でビルド）

---

## 📦 **主な機能**

### 1. プロジェクター選択
* 接続されたディスプレイ（プロジェクター）から投影対象を選択

### 2. 形状編集UI（編集モニターで操作）
* 映像の**表示エリアの端**を編集（縦横10点ずつの外周のみ）
* GUI上でドラッグ操作可能な点群（PyQt/OpenCV + PyOpenGLなどで実装）

### 3. 自動歪み補正
* スクリーン形状（球面・曲面など）に合わせて**自動で画像や映像を歪み補正**
* メディア種類：画像 / 映像（動画ファイル） / 任意のウィンドウ（Window Capture）

---

## 🧮 **パラメータ管理**

* 管理対象：
  * プロジェクターの**発光中心位置**
  * スクリーンの**形状・位置**
  * 反射鏡の**位置と形状（任意）**

* 入力方式：
  * Blender, Unity, Shapr3Dなどの3Dモデル（STL / FBX / glTFなど）を読み込んで自動解析
    → メッシュから面法線と位置関係を抽出してパラメータ自動生成

---

## 💡 実現技術候補
| 機能       | 技術候補                                             |
| -------- | ------------------------------------------------ |
| GUIアプリ構築 | PyQt5 / PySide6 + OpenGL or QGraphicsView        |
| 歪み補正     | OpenCV（`remap`, `warpPerspective`）+ カスタム補正アルゴリズム |
| メディア再生   | OpenCV（画像/映像）+ `pywin32`（ウィンドウキャプチャ）             |
| 3Dモデル読込  | `trimesh`, `pyassimp`, `open3d`, or Blender API  |
| EXE出力    | PyInstaller / cx\_Freeze                         |

---

## 🖥️ GUI画面構成と遷移フロー

### ✅ **1. `main.py`（メイン画面）**

* **構成（上から順）**：
  * 【ディスプレイ選択】ボタン
  * 【メディア選択】ボタン
  * 【オブジェクト選択】ボタン

---

### 📺 **2. ディスプレイ選択ポップアップ**

* **表示内容**：
  * 接続されているディスプレイ一覧(実際のデバイス名をシステムから取得)
  * 各ディスプレイにチェックボックス(複数選択可)
  * チェック済みのディスプレイがある場合、下に「編集」ボタンが出現

#### → 遷移先：**端の形を編集する画面**

---

### 🎞️ **3. メディア選択ポップアップ**

* **3つの選択肢ボタン**：
  * 📷【画像を選ぶ】→ エクスプローラでファイル選択
  * 🎥【動画を選ぶ】→ 同上
  * 🪟【ウィンドウを選ぶ】→ 起動中のウィンドウの一覧をリスト化して選択

---

### 📂 **4. オブジェクト選択（3Dモデル）**

* ボタンを押すと即座にエクスプローラ起動
  * 対象：STL / glTF / FBX …etc 形式

---

## 💾 データの永続化について

* 設定ファイル形式：`config.json`

* 保存内容：
  * ディスプレイごとの端形状座標（10x10点）
  * 最後に選択したディスプレイ・メディア・3Dオブジェクト

* 保存場所：
  * 実行ファイルと同ディレクトリ or `%APPDATA%`に専用フォルダ

---

## ✏️ ** `grid_editor.py` 端の形編集画面**

* **機能**：

  * 縦横10点ずつのグリッドポイントをマウスで調整(微調整できるようにズーム機能と外周外側は黒色に表示する機能も追加)
  * 画面下部：
    * 【保存】ボタン（編集内容を永続化し、アプリを閉じても保持）
    * 【次のディスプレイへ】ボタン（別ディスプレイの編集に移行）

---

### 🎛 1. グリッドUI：外周点のみを編集対象にする

* **技術候補（PyQt）**：

  * `QGraphicsView` + `QGraphicsEllipseItem` + `QGraphicsScene` による実装
  * ポイントのクリック＆ドラッグ移動をサポートし、移動後に補間を実行（OpenCVまたはNumPy）

---

### 💾 2. 永続化処理：設定専用ディレクトリに保存

* **保存場所**例：
  ```
  project_root/
  ├── settings/
  │   ├── display_config_1.json
  │   ├── display_config_2.json
  │   └── ...
  ```

* **保存タイミング**：
  * 「保存」ボタン押下時に自動作成＆上書き(指定した場所に作成)

* **ファイル形式**：
  * JSON推奨（Pythonの組込み`json`で扱いやすい）

---

### 🪟 3. ウィンドウキャプチャ：`pygetwindow`

* **`pygetwindow` の特徴**：
  * シンプルにウィンドウ一覧の取得と選択が可能
  * 選んだウィンドウのタイトル取得／座標取得に強い

* **補足ツール**（キャプチャ用途で必要）：
  * `mss`：画面キャプチャ
  * `pywin32`：より細かな制御（例：ウィンドウを前面に出す、強制リサイズなど）

---

### 🧱 4. 3Dオブジェクト読込ライブラリの比較
| ライブラリ名          | 特徴            | 対応フォーマット               | Python対応             | 利点                    | 欠点                      |
| --------------- | ------------- | ---------------------- | -------------------- | --------------------- | ----------------------- |
| **trimesh**     | 軽量3Dジオメトリ処理向け | STL, OBJ, glTF, PLYなど  | ◎                    | シンプル、依存少なめ、NumPyと親和性◎ | 材質や階層構造は扱いづらい           |
| **open3d**      | 点群・メッシュ処理に強い  | PLY, XYZ, OBJ, STLなど   | ◎                    | 点群⇄メッシュ変換も可、視覚化機能あり   | やや重い、データ前処理が必要          |
| **Blender API** | 完全な3D統合環境     | .blend, FBX, glTFなどすべて | △（Blender内でPython動作） | マテリアル・階層・ボーンなど高精度     | 外部スクリプト制御が複雑。Blenderが必要 |

* **Shapr3Dとの互換性重視なら**：
  * Shapr3Dは**STEP, IGES, STL, OBJ**などをエクスポート可能
  * → `trimesh` または `open3d` がおすすめ（特に `STL` との相性が良好）

---

→`trimesh`と`STL`を使って読み込ませたい。
